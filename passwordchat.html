<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Protected Landing</title>
  <style>
    :root{font-family:system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial}
    body{display:flex;min-height:100vh;align-items:center;justify-content:center;background:#0f172a;color:#e6eef8;margin:0}
    .card{background:linear-gradient(180deg,rgba(255,255,255,0.03),rgba(255,255,255,0.01));padding:28px;border-radius:12px;box-shadow:0 6px 30px rgba(2,6,23,0.6);width:380px}
    h1{margin:0 0 12px;font-size:20px}
    p{margin:0 0 20px;color:#a9bfd6}
    label{display:block;margin-bottom:8px;font-size:13px;color:#cfe0ff}
    input[type=password], input[type=text]{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:inherit}
    button{margin-top:12px;width:100%;padding:10px;border-radius:8px;border:0;background:#2563eb;color:white;font-weight:600;cursor:pointer}
    .linklike{background:transparent;border:0;color:#93c5fd;cursor:pointer;padding:6px 0;text-decoration:underline;font-size:13px}
    .hidden{display:none}
    .muted{font-size:12px;color:#9fb6d8}
    .admin{margin-top:14px;background:rgba(255,255,255,0.02);padding:12px;border-radius:8px}
    .secret{margin-top:18px;padding:14px;border-radius:8px;background:linear-gradient(90deg, rgba(34,197,94,0.12), rgba(59,130,246,0.06));color:#dff3e6}
    small.warning{display:block;margin-top:12px;color:#fca5a5}
  </style>
</head>
<body>
  <div class="card" id="card">
    <h1 id="title">Protected page</h1>
    <p id="subtitle">This page is protected by a client-side password. Enter the shared password to view the content.</p>

    <!-- Login panel -->
    <div id="loginPanel">
      <label for="pwd">Enter password</label>
      <input id="pwd" type="password" placeholder="Password">
      <button id="btnLogin">Enter</button>
      <button class="linklike" id="showAdmin">Admin</button>
      <small class="muted">Admin lets you change/reset the password (requires current password).</small>
      <small class="warning hidden" id="loginErr">Wrong password â€” try again.</small>
    </div>

    <!-- Admin panel -->
    <div id="adminPanel" class="hidden admin">
      <strong>Admin</strong>
      <div style="margin-top:8px">
        <label for="curPwd">Current password</label>
        <input id="curPwd" type="password" placeholder="Current password">
      </div>
      <div style="margin-top:8px">
        <label for="newPwdAdmin">New password</label>
        <input id="newPwdAdmin" type="password" placeholder="New password">
      </div>
      <button id="btnChange">Change password</button>
      <button id="btnResetAll" style="margin-top:8px;background:#ef4444">Reset (clear stored credentials)</button>
      <small class="muted">Reset clears localStorage values so the defaults will be re-seeded for new visitors.</small>
      <small class="warning hidden" id="adminErr">Admin action failed (wrong current password).</small>
    </div>

    <!-- Secret content (hidden until correct password) -->
    <div id="secretContent" class="hidden secret">
      <h2>Welcome ðŸ‘‹</h2>
      <p>This is the protected landing content. Replace this with your actual landing HTML.</p>
    </div>

    <small class="muted" style="display:block;margin-top:14px">Client-side protection only â€” visible to anyone who inspects this page.</small>
  </div>

  <script>
    // Default (hardcoded) salt + hash for password "letmein"
    // salt is a 16-byte hex string; hash is SHA-256(salt + password)
    const DEFAULT_SALT = '98e27f5181ea6ec8681b13c4235238f0';
    const DEFAULT_HASH = 'c47e5472ea24a1636b4abd103735b4964a7763ef5590139f8f084aa74e6ba4a7';

    // Storage keys
    const HASH_KEY = 'cs_pwd_hash';
    const SALT_KEY = 'cs_pwd_salt';

    // Seed defaults into localStorage on first visit
    if (!localStorage.getItem(HASH_KEY) && !localStorage.getItem(SALT_KEY)) {
      localStorage.setItem(HASH_KEY, DEFAULT_HASH);
      localStorage.setItem(SALT_KEY, DEFAULT_SALT);
    }

    // Utility: text -> ArrayBuffer
    function toBuffer(str){
      return new TextEncoder().encode(str);
    }
    // Utility: bytes -> hex
    function bufToHex(buffer){
      const bytes = new Uint8Array(buffer);
      return Array.from(bytes).map(b => b.toString(16).padStart(2,'0')).join('');
    }

    async function sha256Hex(text){
      const buf = await crypto.subtle.digest('SHA-256', toBuffer(text));
      return bufToHex(buf);
    }

    // DOM refs
    const adminPanel = document.getElementById('adminPanel');
    const secretContent = document.getElementById('secretContent');
    const loginErr = document.getElementById('loginErr');
    const adminErr = document.getElementById('adminErr');

    function show(el){ el.classList.remove('hidden'); }
    function hide(el){ el.classList.add('hidden'); }

    async function verifyPassword(plain){
      const salt = localStorage.getItem(SALT_KEY);
      const expected = localStorage.getItem(HASH_KEY);
      if (!salt || !expected) return false;
      const hash = await sha256Hex(salt + plain);
      return hash === expected;
    }

    // Login
    document.getElementById('btnLogin').addEventListener('click', async ()=>{
      loginErr.classList.add('hidden');
      const p = document.getElementById('pwd').value;
      if (!p){ loginErr.textContent = 'Enter a password.'; loginErr.classList.remove('hidden'); return; }
      const ok = await verifyPassword(p);
      if (ok){
        hide(document.getElementById('loginPanel'));
        hide(document.getElementById('title'));
        hide(document.getElementById('subtitle'));
        show(secretContent);
      } else {
        loginErr.textContent = 'Wrong password â€” try again.';
        loginErr.classList.remove('hidden');
      }
    });

    // Toggle admin
    document.getElementById('showAdmin').addEventListener('click', ()=>{
      adminErr.classList.add('hidden');
      if (adminPanel.classList.contains('hidden')) show(adminPanel); else hide(adminPanel);
    });

    // Change password (admin) â€” requires current password
    async function setPasswordClientSide(plain){
      // create new random salt and store hash
      const arr = new Uint8Array(16);
      crypto.getRandomValues(arr);
      const salt = Array.from(arr).map(b => b.toString(16).padStart(2,'0')).join('');
      const hash = await sha256Hex(salt + plain);
      localStorage.setItem(HASH_KEY, hash);
      localStorage.setItem(SALT_KEY, salt);
    }

    document.getElementById('btnChange').addEventListener('click', async ()=>{
      adminErr.classList.add('hidden');
      const cur = document.getElementById('curPwd').value;
      const nw = document.getElementById('newPwdAdmin').value;
      if (!cur || !nw){ adminErr.textContent = 'Fill both fields.'; adminErr.classList.remove('hidden'); return; }
      const ok = await verifyPassword(cur);
      if (!ok){ adminErr.textContent = 'Wrong current password.'; adminErr.classList.remove('hidden'); return; }
      await setPasswordClientSide(nw);
      alert('Password changed (client-side).');
      document.getElementById('curPwd').value = '';
      document.getElementById('newPwdAdmin').value = '';
    });

    // Reset all stored credentials (clears hash + salt)
    document.getElementById('btnResetAll').addEventListener('click', ()=>{
      if (!confirm('Reset will clear stored credentials in this browser, allowing defaults to be re-seeded. Continue?')) return;
      localStorage.removeItem(HASH_KEY);
      localStorage.removeItem(SALT_KEY);
      alert('Credentials cleared. The defaults will be re-seeded on next load.');
      location.reload();
    });

    // Nothing else to init â€” login panel already visible by default
  </script>
</body>
</html>